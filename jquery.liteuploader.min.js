/* liteUploader v3.0.0 | https://github.com/burt202/lite-uploader | Aaron Burtnyk (http://www.burtdev.net) */
!function(t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery")):t($)}(function(t){function e(t,e,i){this.options=this._applyDefaults(t),this._getFiles=e,this._triggerEvent=i,this.xhrs=[]}return t.fn.liteUploader=function(i){return this.each(function(){var r=function(){return t(this).get(0).files}.bind(this);i.ref=i.ref||t(this).attr("name"),t.data(this,"liteUploader",new e(i,r,t(this).trigger.bind(t(this))))})},e.prototype={_applyDefaults:function(e){return t.extend({script:null,rules:{allowedFileTypes:null,maxSize:null},ref:null,params:{},headers:{},singleFileUploads:!1,beforeRequest:function(e,i){return t.when(i)}},e)},_validateOptionsAndFiles:function(){var t=this._getFiles(),e=this._getGeneralErrors(t);e||(e=this._getFileErrors(t)),e?this._triggerEvent("lu:errors",e):(this._triggerEvent("lu:start",t),this._startUploadWithFiles(t))},_startUploadWithFiles:function(e){this.options.singleFileUploads?t.each(e,function(t){this._beforeUpload([e[t]])}.bind(this)):this._beforeUpload(e)},_beforeUpload:function(t){this._triggerEvent("lu:before",t),this.options.beforeRequest(t,this._collateFormData(t)).done(this._performUpload.bind(this))},_getGeneralErrors:function(t){var e=[],i=[];return this.options.ref||e.push({type:"refRequired"}),this.options.script||e.push({type:"scriptOptionRequired"}),0===t.length&&e.push({type:"noFilesSelected"}),i.push({name:"_general",errors:e}),e.length>0?[i]:null},_getFileErrors:function(e){var i=0,r=[];return t.each(e,function(t){var n=this._findErrorsForFile(e[t]);r.push({name:e[t].name,errors:n}),i+=n.length}.bind(this)),i>0?[r]:null},_findErrorsForFile:function(e){var i=[];return t.each(this.options.rules,function(t,r){"allowedFileTypes"===t&&r&&!this._isAllowedFileType(r,e.type)&&i.push({type:"type",rule:r,given:e.type}),"maxSize"===t&&r&&e.size>r&&i.push({type:"size",rule:r,given:e.size})}.bind(this)),i},_isAllowedFileType:function(e,i){var r=e.split(","),n=/([a-z]+)\/\*$/;return-1!==t.inArray(i,r)?!0:r.reduce(function(t,e){if(t)return t;var r=e.match(n)||[];return r[1]===i.split("/")[0]},!1)},_getFormDataObject:function(){return new FormData},_collateFormData:function(e){var i=this._getFormDataObject();return t.each(this.options.params,function(t,e){i.append(t,e)}),t.each(e,function(t){i.append(this.options.ref,e[t])}.bind(this)),i},_getXmlHttpRequestObject:function(){return new XMLHttpRequest},_buildXhrObject:function(){var t=this._getXmlHttpRequestObject();return t.upload.addEventListener("progress",this._onXHRProgress.bind(this),!1),this.xhrs.push(t),t},_performUpload:function(e){t.ajax({xhr:this._buildXhrObject.bind(this),url:this.options.script,type:"POST",data:e,headers:this.options.headers,processData:!1,contentType:!1}).done(this._onXHRSuccess.bind(this)).fail(this._onXHRFailure.bind(this))},_onXHRProgress:function(t){t.lengthComputable&&this._triggerEvent("lu:progress",Math.floor(t.loaded/t.total*100))},_onXHRSuccess:function(t){this._triggerEvent("lu:success",t)},_onXHRFailure:function(t){this._triggerEvent("lu:fail",t)},startUpload:function(){this._validateOptionsAndFiles()},addParam:function(t,e){this.options.params[t]=e},cancelUpload:function(){this.xhrs.forEach(function(t){t.abort()}),this._triggerEvent("lu:cancelled")}},e});