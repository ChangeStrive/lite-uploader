/* liteUploader v2.3.0 | https://github.com/burt202/lite-uploader | Aaron Burtnyk (http://www.burtdev.net) */
function LiteUploader(t,e,i){this.el=$(t),this.options=this._applyDefaults(e),this.ref=i,this.onEvent=this.el.trigger.bind($),this.xhrs=[],this._init()}$.fn.liteUploader=function(t){return this.each(function(){$.data(this,"liteUploader",new LiteUploader(this,t,$(this).attr("name")))})},window.LiteUploader=LiteUploader,LiteUploader.prototype={_init:function(){this.options.changeHandler&&this.el.change(function(){this._validateOptionsAndFiles()}.bind(this)),this.options.clickElement&&this.options.clickElement.click(function(){this._validateOptionsAndFiles()}.bind(this))},_getFiles:function(){return this.el.get(0).files},_applyDefaults:function(t){return $.extend({script:null,rules:{allowedFileTypes:null,maxSize:null},params:{},headers:{},changeHandler:!0,clickElement:null,singleFileUploads:!1,beforeRequest:function(t,e){return $.when(e)}},t)},_triggerEvent:function(t,e){this.onEvent(t,e)},_validateOptionsAndFiles:function(){var t=this._getFiles(),e=this._getGeneralErrors(t);e||(e=this._getFileErrors(t)),e?this._triggerEvent("lu:errors",e):(this._triggerEvent("lu:start",t),this._startUploadWithFiles(t))},_startUploadWithFiles:function(t){this.options.singleFileUploads?t.forEach(function(t){this._beforeUpload([t])}.bind(this)):this._beforeUpload(t)},_beforeUpload:function(t){this._triggerEvent("lu:before",t),this.options.beforeRequest(t,this._collateFormData(t)).done(this._performUpload.bind(this))},_getGeneralErrors:function(t){var e=[],i=[];return this.ref||e.push({type:"fileRefRequired"}),this.options.script||e.push({type:"scriptOptionRequired"}),0===t.length&&e.push({type:"noFilesSelected"}),i.push({name:"_general",errors:e}),e.length>0?[i]:null},_getFileErrors:function(t){var e=0,i=t.map(function(t){var i=this._findErrorsForFile(t);return e+=i.length,{name:t.name,errors:i}}.bind(this));return e>0?[i]:null},_findErrorsForFile:function(t){var e=[];return $.each(this.options.rules,function(i,n){"allowedFileTypes"===i&&n&&-1===n.split(",").indexOf(t.type)&&e.push({type:"type",rule:n,given:t.type}),"maxSize"===i&&n&&t.size>n&&e.push({type:"size",rule:n,given:t.size})}),e},_getFormDataObject:function(){return new FormData},_collateFormData:function(t){var e=this._getFormDataObject();return $.each(this.options.params,function(t,i){e.append(t,i)}),t.forEach(function(t){e.append(this.ref,t)}.bind(this)),e},_getXmlHttpRequestObject:function(){return new XMLHttpRequest},_buildXhrObject:function(){var t=this._getXmlHttpRequestObject();return t.upload.addEventListener("progress",this._onXHRProgress.bind(this),!1),this.xhrs.push(t),t},_performUpload:function(t){$.ajax({xhr:this._buildXhrObject.bind(this),url:this.options.script,type:"POST",data:t,headers:this.options.headers,processData:!1,contentType:!1}).done(this._onXHRSuccess.bind(this)).fail(this._onXHRFailure.bind(this))},_onXHRProgress:function(t){t.lengthComputable&&this._triggerEvent("lu:progress",Math.floor(t.loaded/t.total*100))},_onXHRSuccess:function(t){this._triggerEvent("lu:success",t)},_onXHRFailure:function(t){this._triggerEvent("lu:fail",t)},addParam:function(t,e){this.options.params[t]=e},cancelUpload:function(){this.xhrs.forEach(function(t){t.abort()}),this._triggerEvent("lu:cancelled")}};